# 工作日报         -- 2020-1-8 -- 

## 1. 修改用户主页缓存多次跳转的问题：

#### (1). 用户详情页存在跳转读取缓存数据不稳定的bug，原因是用户粉丝列表页的读取缓存方法没有在读取结束之后删除最后一条缓存，以及粉丝列表之前的记录三层缓存机制没有取消。

> #### ***优化缓存设计***

>> + 在这种多级递归调用组件页面的场景判断路由方向是一个关键的难点，即我们如何知道路由打开的是新的页面还是之前访问过的页面，我们一定要知道路由的方向才能判断是否读取缓存还是请求新的数据。

>> + 之前的设计是通过返回组件来判断路由的方向即点击页面组件上的返回按钮才能识别出路由的方向，这样页面的功能就强依赖于组件了，如果在手机端通过点击系统的HOME键实现返回就会出错，优化的修改设计是把路由的次序通过query拼接在页面url上，这样页面的访问深度就不依赖组件提供的状态了，在路由守卫里面判断页面的URL上面的访问深度查询参数来判断路由方向，这样能更加稳定。

## 2. 发现页推荐媒体：

#### (1). 发现页推荐媒体显示媒体的简介和引用信息的判断条件修改，之前的条件是判断媒体对象的简介字段内容是否不为空即：
```javascript
v-if="item.summary !== ''"  
// 判断summary字段是否不为空
```
这种判断在后台数据没传summary字段的时候会判断为true，导致显示一个空白的行。修改以后的判断条件为：
```javascript
v-if="item.summary && item.summary !== ''"  
// 即现判断是否有sunmmary字段，同时summary字段的值不能为空，满足条件才显示
```

## 3. 改进需求 -> 发现页推荐媒体轮播图循环滚动（正在进行）：

#### (1). 之前的设计是发现页推荐媒体轮播图固定数量两端滚动有限，滚动到第一张或最后一张的时候不能继续滚动，现在的改进是要求实现循环滚动。

> #### ***设计方案***

>> 首先为了实现循环轮播图，而且是双向的循环切换，这时就需要 n + 2 （开头前面放一张最后一页，结尾后面放一张第一页）张轮播图页面，这样才能实现双向的无缝切换效果，并且这两张预留的页面不占用分页器的显示。

## 4. 发现页推荐媒体请求有关媒体接口解耦合：

#### (1). 之前的设计是在页面初始化30条推荐数据的时候就同时把相关媒体字段一同请求出来，这样的设计初始请求的负担太重数据搜索很慢，而且感觉效率很低，因为用户初始化页面的时候只看第一页，但是初始的请求就一下子把十页的数据都请求完了，这样导致页面初始展示非常慢，新的设计是将数据对象中的相关媒体字段拆分成独立的请求，这样就可以按需请求数据，在初始化页面时只请求第一页的数据然后在每一次切换新页面的时候请求下一页3个媒体的相关媒体信息，如果该媒体已经请求过“相关媒体”的字段则不发起请求。这样可以加快页面初始加载的速度、降低服务器单个请求的压力。














