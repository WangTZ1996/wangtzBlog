# 工作日报             -- 2020-1-9 --

## 1. PC端微信扫码登录流程：

#### ***步骤***

+ 首先要在微信开放平台里申请创建一个web应用，填写完基本信息之后提交审核，最长7个工作日，一般两天就能下来。审核通过以后可以得到web应用的AppID和AppSecret，稍后请求微信登录的二维码。

+ 在得到web应用的AppID以后前端需要配置请求登录二维码的url：

```javascript
// 前端使用appid和回调域名来获取微信登陆二维码

window.location.replace( 
	"https://open.weixin.qq.com/connect/qrconnect?" + 
	"appid=" + APP_id + "&" + 
	"redirect_uri=" + encodeURIComponent('http://wx.digitwonder.com') + "&" + 
	"scope=snsapi_login#wechat_redirect" )
```
> 这个配置中AppID字段是向后台传微信开放平台的web应用AppID，回调地址也是在开放平台注册时留的地址，而且这个回调地址的uri需要经过encode编码加密以后拼接到请求的。'scope'字段表示请求的作用域，微信扫码登录时scope字段固定写'snsapi_login'。将这个地址拼接好以后就可以将路由定向到微信的二维码页面了。

###### 参数说明


参数  | 是否必须  | 说明 
:---:|:---:|:---
 appid | 是  | 应用唯一标识（前面认证网页应用中获得）
redirect_uri | 是 | 重定向地址，需要进行UrlEncode（前面认证网页应用中获得）
response_type | 是 | 填code
scope | 是 | 应用授权作用域，拥有多个作用域用逗号（,）分隔，网页应用目前仅填写snsapi_login即可
state | 是 | 用于保持请求和回调的状态，授权请求后原样带回给第三方。该参数可用于防止csrf攻击（跨站请求伪造攻击），建议第三方带上该参数，可设置为简单的随机数加session进行校验



+ 在页面定位到微信二维码页面以后扫码确认，页面会被定向到之前配置的回调页面地址并且将请求来的code拼接到url上一并返回，我们在微信确认登陆以后回到url拼接有code的页面获取到code之后向后台发送登陆请求。

+ 后台接收到code之后，将code和AppId还有AppSecret放到一个请求里向微信服务器换取accessToken。

```javascript
// 得到code以后通过code获取accessToken

https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&secret=SECRET&code=CODE&grant_type=authorization_code
```
###### 参数说明

参数 | 是否必须 | 说明
:---: | :---: | :---
appid | 是 | 应用唯一标识，在微信开放平台提交应用审核通过后获得
secret | 是 | 应用密钥AppSecret，在微信开放平台提交应用审核通过后获得
code | 是 | 填写第一步获取的code参数
grant_type | 是 | 填authorization_code


## 2. H5项目全局文案、样式修改：

#### (1). 所有的小T改成小贝：

+ 引导页第二步选择关注媒体页的title

+ 推荐页侧边筛选菜单栏

+ 创建主题第一步

+ 推荐页主体页面

+ 测评页（修改四处）

#### (2). 测评页长按保存的图标修改：

## 3. 创建情报站数量限制开启：

#### (1). 在创建情报站数量限制开启以后，普通用户创建一个情报站之后不能再创建情报站，删除情报站之后判断条件没有及时修改导致删除了一个情报站之后不能再次创建。

#### (2). 创建主题选择标签处样式修改。

## 4. 测评结果页返回按钮方法修改：

#### (1). 测评结果页在安卓手机微信环境下如果退回到浮窗模式会出现返回找不到原路径的情况，这时检测路径url上是否有从浮窗返回到标志。
 
#### (2). 测评系统的分享：

+ 一键导入情报网分享出去的连接就是上传截图的页面。

+ 测评功能入口分享出去就是测评功能。

## 5. 创建情报站返回到空白页错误：

#### (1). 从情报站收录文章页面进入创建的主题返回时寻找的还是那个弹窗页面但是这个功能没有路由所以找不到。










